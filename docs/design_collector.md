# 詳細設計: Collector (論文収集)

## 1. 役割
`S2Collector` クラスは、Semantic Scholar (S2AG) API および ArXiv API を利用して、指定されたキーワードと Seed Paper を起点に関連論文を広範囲に収集する役割を担う。

## 2. 主要機能

### 2.1 キーワード検索 (`search_by_keywords`)
- **API:** `paper/search` エンドポイントを使用。
- **処理:** 指定された複数のキーワードをスペース区切りでクエリとして送信し、上位の論文（デフォルト100件）を取得する。
- **取得項目:** `title`, `year`, `citationCount`, `abstract`, `externalIds`, `url`。

### 2.2 スノーボールサンプリング (`get_related_papers`)
- **API:** `paper/DOI:<doi>` エンドポイントを使用。
- **処理:** 指定された DOI の論文の `references` (参考文献) と `citations` (被引用文献) を1階層取得する。
- **統合:** 取得した参考文献と被引用文献を一つのリストに統合して返す。

### 2.3 抄録補完 (`_fill_missing_abstracts_with_arxiv`)
- **背景:** S2AG では著作権等の理由でアブストラクトが取得できない場合がある。
- **API:** `arxiv` ライブラリ（ArXiv API）を使用。
- **アルゴリズム:**
    1. アブストラクトが空の論文を特定。
    2. タイトルまたは DOI で ArXiv を検索。
    3. ヒットした場合、タイトルの類似度を確認してアブストラクトを補完。
- **制約:** 1秒の `sleep` を挟むことでレート制限を回避。

### 2.4 統合収集フロー (`collect`)
1. **キーワード検索の実行**: 関連論文の初期セットを取得。
2. **スノーボール起点の拡張**:
    - ユーザー指定の `seed_paper_dois` を追加。
    - `snowball_from_keywords_limit` に基づき、キーワード検索上位の DOI を追加。
3. **ネットワーク探索**: 拡張された起点リストの各論文に対して引用・参考文献を取得。
4. **重複排除**: DOI 優先、次いでタイトル一致による重複削除を実行。
5. **フィルタリング**: `min_citations` および `year_range` による初期フィルタ。
6. **補完**: 最終的なリストに対して抄録補完を実行。

## 3. 非機能仕様
- **エラーハンドリング:** `tenacity` を用いた指数バックオフによるリトライ（429 Rate Limit および 5xx エラー対象）。
- **ロギング:** 収集件数や API エラーの詳細を `review.collector` 階層のロガーに出力。
- **パフォーマンス:** 抽出効率向上のため、大量のリクエストが発生するスノーボール処理には丁寧なエラーハンドリングを実装。
