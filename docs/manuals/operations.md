# Operations & Troubleshooting Guide

## 1. 運用フロー

### 1.1 基本実行サイクル
1. **設定**: `config.yml` または Web UI の `Configuration` タブで探索条件を設定。
2. **開始**: `Start Review Process` ボタンまたは `main.py` で実行開始。
3. **モニタリング**: ログ出力で進捗（収集件数、スクリーニング済み件数）を確認。
4. **結果確認**: `final/final_review_matrix.csv` を出力。

### 1.2 長時間実行時の挙動
本システムは数十分〜数時間の実行を想定しています。
- **スリープ処理**: APIレート制限に達した場合、自動的に待機 (`tenacity` によるリトライ) が発生します。
- **チェックポイント**: 各イテレーションの終了時に `raw/` および `interim/` にCSVが保存されます。

---

## 2. トラブルシューティング

### 2.1 "Rate limit or server error hit" が頻発する
- **原因**: Semantic Scholar API のレート制限 (100 req/5min 程度) に達しています。
- **対策**:
  - システムは自動的に `wait_exponential` (最大120秒待機) でリトライします。**強制終了せず、そのまま待機してください。**
  - APIキー (`SEMANTIC_SCHOLAR_API_KEY`) を `.env` に設定することで、制限が緩和される場合があります。

### 2.2 プロセスが途中で止まってしまった (クラッシュ等)
- **復旧**:
  - 現在のバージョンでは「完全な途中再開」機能は CLI 引数としては提供されていません。
  - **回避策**: 収集済みの DOI を `exclude_dois` に追加したり、 `seed_paper_dois` を調整して、別プロジェクトとして実行することをお勧めします。
  - (※ 将来的に `resume_from` 機能が実装される予定です)

### 2.3 スクレイピングエラー (ArXiv)
- **現象**: `Failed to fetch abstract from ArXiv` ログが出る。
- **影響**: その論文のアブストラクトが欠損するため、スクリーニング対象外となります。
- **対策**: ArXiv API は一時的に不安定になることがあります。時間を置いて再実行するか、諦めて他のソースを優先してください。

---

## 3. コストとパフォーマンス

### 3.1 LLM コスト見積もり (Gemini 2.0 Flash-Lite)
- **入力**: 1論文あたり 約300〜500トークン (Title + Abstract)
- **試算**:
    - 1,000件スクリーニング: 約50万トークン
    - Flash-Lite は非常に安価ですが、大量処理時は Google Cloud の制限 (Quota) に注意してください。

### 3.2 パフォーマンス設定
- `max_screening_workers` (デフォルト5): LLM呼び出しの並列数。
- **上げすぎ注意**: 10以上にすると `429 Resource Exhausted` エラーが増える可能性があります。
