# 詳細設計: Dashboard (UI)

## 1. 役割
`app.py` は Streamlit を利用した Web インターフェースを提供し、ユーザーが直感的にパイプラインの設定、実行、結果の確認を行えるようにする。

## 2. 画面構成

### 2.1 ナビゲーション (サイドバー)
- **Configuration (設定):** `config.yml` の読み書きを行う。
- **Execution (実行):** パイプラインの実行と過去の結果表示を行う。

### 2.2 設定画面 (`mode == "config"`)
- **Project Settings:** プロジェクト名の設定。
- **Search Criteria:** キーワード、Seed DOI (バリデーション付き)、閾値、年度範囲等の設定。
- **Advanced Settings (Expander):** モデル名、ログレベル等の詳細設定。
- **保存機能:** 入力値を `config.yml` に `yaml.safe_dump` で保存。

### 2.3 実行画面 (`mode == "exec"`)
- **実行トリガー:** `subprocess.Popen` を使用して `main.py` をバックグラウンド実行。
- **リアルタイムログ:** `stdout` を非同期に読み取り、`st.code` ブロックにリアルタイムで追記表示。
- **ステータス表示:** 終了コードに応じた成功/失敗のメッセージ表示。

### 2.4 結果ビューア
- **履歴選択:** プロジェクトフォルダ内の日付・時刻付きディレクトリをリスト表示。
- **データ表示:** 選択された実行結果の `final_review_matrix.csv` を `st.dataframe` で表示。
- **ダウンロード:** CSV ファイルをダウンロードボタン経由で提供。

## 3. 実装詳細

### 3.1 設定管理
- `src.utils.io_utils` の `load_config` を補助的に使いつつ、UI 上での編集を可能にするため `yaml` ライブラリで直接ファイルを操作する。
- DOI 入力時には正規表現による簡易的なフォーマットチェックを行い、誤入力を防ぐ。

### 3.2 パイプライン連携
- `main.py` を外部プロセスとして呼び出すことで、UI のフリーズを防ぎ、かつ CLI と同一のロジックが実行されることを保証。
- 実行ログの逐次表示により、完了を待たずに進捗を確認可能。

## 4. 非機能仕様
- **デザイン:** カスタム CSS (`assets/style.css`) の適用による視認性の向上。
- **ユーザビリティ:** インフォボックスや警告メッセージを活用したガイダンス。
- **永続性:** 保存された設定は次回起動時にも引き継がれる。
